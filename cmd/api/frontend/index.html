<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DevrimSoft Bug Report</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#f5f5f7;--card:#fff;--border:#e0e0e0;--text:#1d1d1f;--muted:#6e6e73;
  --primary:#0071e3;--primary-hover:#0060c0;--success:#34c759;--error:#ff3b30;
  --radius:12px;--shadow:0 1px 3px rgba(0,0,0,.08),0 4px 12px rgba(0,0,0,.04);
  --font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
}
body{font-family:var(--font);background:var(--bg);color:var(--text);line-height:1.5;min-height:100vh;padding:24px 16px}
.container{max-width:640px;margin:0 auto}
header{text-align:center;margin-bottom:32px}
header h1{font-size:1.5rem;font-weight:600;margin-bottom:4px}
header p{color:var(--muted);font-size:.875rem}
.lang-bar{display:flex;justify-content:center;gap:6px;margin-top:12px}
.lang-btn{
  padding:4px 10px;border:1px solid var(--border);border-radius:6px;background:var(--card);
  cursor:pointer;font-size:.75rem;font-weight:500;color:var(--muted);transition:all .15s
}
.lang-btn:hover{border-color:var(--primary);color:var(--primary)}
.lang-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:28px;margin-bottom:20px}
label{display:block;font-size:.8125rem;font-weight:500;margin-bottom:6px;color:var(--text)}
.required::after{content:" *";color:var(--error)}
input,select,textarea{
  width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:8px;font-size:.875rem;
  font-family:var(--font);background:var(--card);color:var(--text);transition:border-color .15s;outline:none
}
input:focus,select:focus,textarea:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(0,113,227,.12)}
textarea{resize:vertical;min-height:120px}
select{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236e6e73' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:32px}
select:disabled{opacity:.7;cursor:not-allowed;background-color:#f9f9f9}
.field{margin-bottom:18px}
.field:last-child{margin-bottom:0}
.field-note{font-size:.75rem;color:var(--muted);margin-top:4px}
.auto-detected{color:var(--success);font-weight:500}
.collapsible-header{
  display:flex;align-items:center;gap:8px;cursor:pointer;font-size:.875rem;font-weight:500;
  color:var(--primary);margin-bottom:12px;user-select:none
}
.collapsible-header svg{transition:transform .2s}
.collapsible-header.open svg{transform:rotate(90deg)}
.collapsible-content{display:none}
.collapsible-content.open{display:block}
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.drop-zone{
  border:2px dashed var(--border);border-radius:8px;padding:24px;text-align:center;cursor:pointer;
  transition:border-color .15s,background .15s;position:relative
}
.drop-zone:hover,.drop-zone.drag-over{border-color:var(--primary);background:rgba(0,113,227,.03)}
.drop-zone input{position:absolute;inset:0;opacity:0;cursor:pointer}
.drop-zone p{font-size:.8125rem;color:var(--muted)}
.drop-zone .icon{font-size:1.5rem;margin-bottom:4px;color:var(--muted)}
.preview-grid{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
.preview-item{
  position:relative;width:80px;height:80px;border-radius:8px;overflow:hidden;
  border:1px solid var(--border)
}
.preview-item img{width:100%;height:100%;object-fit:cover}
.preview-item button{
  position:absolute;top:2px;right:2px;width:20px;height:20px;border-radius:50%;border:none;
  background:rgba(0,0,0,.6);color:#fff;font-size:.75rem;cursor:pointer;display:flex;align-items:center;justify-content:center;line-height:1
}
.btn-submit{
  width:100%;padding:14px;border:none;border-radius:10px;background:var(--primary);color:#fff;
  font-size:1rem;font-weight:600;cursor:pointer;transition:background .15s;font-family:var(--font)
}
.btn-submit:hover{background:var(--primary-hover)}
.btn-submit:disabled{opacity:.5;cursor:not-allowed}
.msg{padding:14px;border-radius:8px;font-size:.875rem;margin-top:16px;display:none}
.msg.success{display:block;background:#e8f8ed;color:#1a7f37;border:1px solid #c6efce}
.msg.error{display:block;background:#fdecea;color:#cc1d1d;border:1px solid #f5c6cb}
.spinner{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite;vertical-align:middle;margin-right:6px}
@keyframes spin{to{transform:rotate(360deg)}}
@media(max-width:480px){
  .two-col{grid-template-columns:1fr}
  .card{padding:20px}
  body{padding:16px 12px}
}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1 id="pageTitle">Hata Bildirim</h1>
    <p id="pageSubtitle">Karsilastiginiz hatalari bize bildirin</p>
    <div class="lang-bar">
      <button class="lang-btn active" onclick="setLang('tr')">TR</button>
      <button class="lang-btn" onclick="setLang('en')">EN</button>
      <button class="lang-btn" onclick="setLang('de')">DE</button>
      <button class="lang-btn" onclick="setLang('ru')">RU</button>
      <button class="lang-btn" onclick="setLang('uk')">UK</button>
    </div>
  </header>

  <form id="bugForm" novalidate>
    <div class="card">
      <div class="field">
        <label for="siteSelect" class="required" id="labelSite">Site</label>
        <select id="siteSelect" required></select>
        <div class="field-note" id="siteNote"></div>
      </div>

      <div class="field">
        <label for="titleInput" class="required" id="labelTitle">Baslik</label>
        <input type="text" id="titleInput" maxlength="200" required>
      </div>

      <div class="field">
        <label for="categorySelect" class="required" id="labelCategory">Kategori</label>
        <select id="categorySelect" required>
          <option value="" id="optCatPlaceholder">Secin...</option>
          <option value="design" id="optDesign">Tasarim</option>
          <option value="functionality" id="optFunctionality">Islevsellik</option>
          <option value="performance" id="optPerformance">Performans</option>
          <option value="content" id="optContent">Icerik</option>
          <option value="mobile" id="optMobile">Mobil</option>
          <option value="security" id="optSecurity">Guvenlik</option>
          <option value="other" id="optOther">Diger</option>
        </select>
      </div>

      <div class="field">
        <label for="descInput" class="required" id="labelDesc">Aciklama</label>
        <textarea id="descInput" maxlength="5000" required></textarea>
      </div>

      <div class="field">
        <label for="pageUrlInput" id="labelPageUrl">Sayfa URL'i</label>
        <input type="url" id="pageUrlInput" placeholder="https://...">
      </div>
    </div>

    <div class="card">
      <div class="collapsible-header" id="contactToggle" onclick="toggleContact()">
        <svg width="12" height="12" viewBox="0 0 12 12"><path fill="currentColor" d="M4 1l5 5-5 5z"/></svg>
        <span id="labelContact">Iletisim Bilgileri (Opsiyonel)</span>
      </div>
      <div class="collapsible-content" id="contactContent">
        <div class="two-col">
          <div class="field">
            <label for="firstNameInput" id="labelFirstName">Ad</label>
            <input type="text" id="firstNameInput" maxlength="100">
          </div>
          <div class="field">
            <label for="lastNameInput" id="labelLastName">Soyad</label>
            <input type="text" id="lastNameInput" maxlength="100">
          </div>
        </div>
        <div class="two-col" style="margin-top:12px">
          <div class="field">
            <label for="contactTypeSelect" id="labelContactType">Iletisim Turu</label>
            <select id="contactTypeSelect">
              <option value="">-</option>
              <option value="email">E-posta</option>
              <option value="phone" id="optPhone">Telefon</option>
              <option value="telegram">Telegram</option>
              <option value="instagram">Instagram</option>
            </select>
          </div>
          <div class="field">
            <label for="contactValueInput" id="labelContactValue">Iletisim Degeri</label>
            <input type="text" id="contactValueInput" maxlength="200">
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <label id="labelImages">Gorseller (Maks. 5)</label>
      <div class="drop-zone" id="dropZone">
        <input type="file" id="fileInput" multiple accept="image/png,image/jpeg,image/webp,image/gif">
        <div class="icon">&#128247;</div>
        <p id="dropText">Dosyalari surukleyin veya tiklayin</p>
      </div>
      <div class="preview-grid" id="previewGrid"></div>
    </div>

    <button type="submit" class="btn-submit" id="submitBtn">Gonder</button>
    <div class="msg" id="resultMsg"></div>
  </form>
</div>

<script>
const API_KEY = '__PORTAL_API_KEY__';
const PORTAL_DOMAIN = '__PORTAL_DOMAIN__';

const T = {
  tr: {
    pageTitle: 'Hata Bildirim',
    pageSubtitle: 'Karsilastiginiz hatalari bize bildirin',
    labelSite: 'Site',
    labelTitle: 'Baslik',
    labelCategory: 'Kategori',
    labelDesc: 'Aciklama',
    labelPageUrl: 'Sayfa URL\'i',
    labelContact: 'Iletisim Bilgileri (Opsiyonel)',
    labelFirstName: 'Ad',
    labelLastName: 'Soyad',
    labelContactType: 'Iletisim Turu',
    labelContactValue: 'Iletisim Degeri',
    labelImages: 'Gorseller (Maks. 5)',
    dropText: 'Dosyalari surukleyin veya tiklayin',
    submitBtn: 'Gonder',
    sending: 'Gonderiliyor...',
    successMsg: 'Hata bildiriminiz basariyla gonderildi. Tesekkurler!',
    errorGeneric: 'Bir hata olustu. Lutfen tekrar deneyin.',
    autoDetected: 'Otomatik algilandi',
    selectPlaceholder: 'Secin...',
    catDesign: 'Tasarim',
    catFunctionality: 'Islevsellik',
    catPerformance: 'Performans',
    catContent: 'Icerik',
    catMobile: 'Mobil',
    catSecurity: 'Guvenlik',
    catOther: 'Diger',
    optPhone: 'Telefon',
    titlePlaceholder: 'Kisa bir baslik yazin',
    descPlaceholder: 'Hatayi detayli olarak aciklayin',
    maxImages: 'En fazla 5 gorsel yuklenebilir',
    siteSelectPlaceholder: 'Site secin...'
  },
  en: {
    pageTitle: 'Bug Report',
    pageSubtitle: 'Report bugs you encounter',
    labelSite: 'Site',
    labelTitle: 'Title',
    labelCategory: 'Category',
    labelDesc: 'Description',
    labelPageUrl: 'Page URL',
    labelContact: 'Contact Info (Optional)',
    labelFirstName: 'First Name',
    labelLastName: 'Last Name',
    labelContactType: 'Contact Type',
    labelContactValue: 'Contact Value',
    labelImages: 'Screenshots (Max 5)',
    dropText: 'Drag files here or click to browse',
    submitBtn: 'Submit',
    sending: 'Sending...',
    successMsg: 'Your bug report has been submitted successfully. Thank you!',
    errorGeneric: 'An error occurred. Please try again.',
    autoDetected: 'Auto-detected',
    selectPlaceholder: 'Select...',
    catDesign: 'Design',
    catFunctionality: 'Functionality',
    catPerformance: 'Performance',
    catContent: 'Content',
    catMobile: 'Mobile',
    catSecurity: 'Security',
    catOther: 'Other',
    optPhone: 'Phone',
    titlePlaceholder: 'Write a short title',
    descPlaceholder: 'Describe the bug in detail',
    maxImages: 'Maximum 5 images allowed',
    siteSelectPlaceholder: 'Select a site...'
  },
  de: {
    pageTitle: 'Fehlerbericht',
    pageSubtitle: 'Melden Sie Fehler, die Sie finden',
    labelSite: 'Webseite',
    labelTitle: 'Titel',
    labelCategory: 'Kategorie',
    labelDesc: 'Beschreibung',
    labelPageUrl: 'Seiten-URL',
    labelContact: 'Kontaktdaten (Optional)',
    labelFirstName: 'Vorname',
    labelLastName: 'Nachname',
    labelContactType: 'Kontaktart',
    labelContactValue: 'Kontaktwert',
    labelImages: 'Bilder (Max. 5)',
    dropText: 'Dateien hierher ziehen oder klicken',
    submitBtn: 'Absenden',
    sending: 'Wird gesendet...',
    successMsg: 'Ihr Fehlerbericht wurde erfolgreich gesendet. Vielen Dank!',
    errorGeneric: 'Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.',
    autoDetected: 'Automatisch erkannt',
    selectPlaceholder: 'Auswahlen...',
    catDesign: 'Design',
    catFunctionality: 'Funktionalitat',
    catPerformance: 'Leistung',
    catContent: 'Inhalt',
    catMobile: 'Mobil',
    catSecurity: 'Sicherheit',
    catOther: 'Sonstiges',
    optPhone: 'Telefon',
    titlePlaceholder: 'Kurzen Titel eingeben',
    descPlaceholder: 'Beschreiben Sie den Fehler im Detail',
    maxImages: 'Maximal 5 Bilder erlaubt',
    siteSelectPlaceholder: 'Webseite auswahlen...'
  },
  ru: {
    pageTitle: 'Otchet ob oshibke',
    pageSubtitle: 'Soobshchite o naydennyh oshibkah',
    labelSite: 'Sayt',
    labelTitle: 'Zagolovok',
    labelCategory: 'Kategoriya',
    labelDesc: 'Opisaniye',
    labelPageUrl: 'URL stranitsy',
    labelContact: 'Kontaktnaya informatsiya (Neobyzatelno)',
    labelFirstName: 'Imya',
    labelLastName: 'Familiya',
    labelContactType: 'Tip kontakta',
    labelContactValue: 'Kontaktnoye znacheniye',
    labelImages: 'Izobrazheniya (Maks. 5)',
    dropText: 'Peretashchite fayly syuda ili nazmite',
    submitBtn: 'Otpravit',
    sending: 'Otpravka...',
    successMsg: 'Vash otchet ob oshibke uspeshno otpravlen. Spasibo!',
    errorGeneric: 'Proizoshla oshibka. Poprobuyete snova.',
    autoDetected: 'Opredeleno avtomaticheski',
    selectPlaceholder: 'Vybrat...',
    catDesign: 'Dizayn',
    catFunctionality: 'Funktsionalnost',
    catPerformance: 'Proizvoditelnost',
    catContent: 'Kontent',
    catMobile: 'Mobilniy',
    catSecurity: 'Bezopasnost',
    catOther: 'Drugoye',
    optPhone: 'Telefon',
    titlePlaceholder: 'Napishite korotkiy zagolovok',
    descPlaceholder: 'Podrobno opishite oshibku',
    maxImages: 'Maksimum 5 izobrazheniy',
    siteSelectPlaceholder: 'Vybrat sayt...'
  },
  uk: {
    pageTitle: 'Zvit pro pomylku',
    pageSubtitle: 'Povidomte pro znaydenni pomylky',
    labelSite: 'Sayt',
    labelTitle: 'Zagolovok',
    labelCategory: 'Kategoriya',
    labelDesc: 'Opys',
    labelPageUrl: 'URL storinky',
    labelContact: "Kontaktna informatsiya (Neobov'yazkovo)",
    labelFirstName: "Im'ya",
    labelLastName: 'Prizvyshche',
    labelContactType: 'Typ kontaktu',
    labelContactValue: 'Kontaktne znachennya',
    labelImages: 'Zobrazhennya (Maks. 5)',
    dropText: 'Peretagnit fayly syudy abo natysnit',
    submitBtn: 'Vidpravyty',
    sending: 'Vidpravka...',
    successMsg: 'Vash zvit pro pomylku uspishno vidpravleno. Dyakuyemo!',
    errorGeneric: 'Stalasya pomylka. Bud laska, sprobujte shche raz.',
    autoDetected: 'Vyznacheno avtomatychno',
    selectPlaceholder: 'Obraty...',
    catDesign: 'Dyzayn',
    catFunctionality: 'Funktsionalnist',
    catPerformance: 'Produktyvnist',
    catContent: 'Kontent',
    catMobile: 'Mobilnyy',
    catSecurity: 'Bezpeka',
    catOther: 'Inshe',
    optPhone: 'Telefon',
    titlePlaceholder: 'Napyshit korotkyy zagolovok',
    descPlaceholder: 'Detalno opishit pomylku',
    maxImages: 'Maksymum 5 zobrazhen',
    siteSelectPlaceholder: 'Obraty sayt...'
  }
};

let currentLang = 'tr';
let sites = [];
let selectedFiles = [];
let autoDetectedSite = false;

function detectLang() {
  const nav = (navigator.language || navigator.userLanguage || 'tr').toLowerCase();
  if (nav.startsWith('en')) return 'en';
  if (nav.startsWith('de')) return 'de';
  if (nav.startsWith('ru')) return 'ru';
  if (nav.startsWith('uk')) return 'uk';
  return 'tr';
}

function setLang(lang) {
  currentLang = lang;
  const t = T[lang];
  document.documentElement.lang = lang;

  document.getElementById('pageTitle').textContent = t.pageTitle;
  document.getElementById('pageSubtitle').textContent = t.pageSubtitle;
  document.getElementById('labelSite').textContent = t.labelSite;
  document.getElementById('labelTitle').textContent = t.labelTitle;
  document.getElementById('labelCategory').textContent = t.labelCategory;
  document.getElementById('labelDesc').textContent = t.labelDesc;
  document.getElementById('labelPageUrl').textContent = t.labelPageUrl;
  document.getElementById('labelContact').textContent = t.labelContact;
  document.getElementById('labelFirstName').textContent = t.labelFirstName;
  document.getElementById('labelLastName').textContent = t.labelLastName;
  document.getElementById('labelContactType').textContent = t.labelContactType;
  document.getElementById('labelContactValue').textContent = t.labelContactValue;
  document.getElementById('labelImages').textContent = t.labelImages;
  document.getElementById('dropText').textContent = t.dropText;
  document.getElementById('submitBtn').textContent = t.sending === t.submitBtn ? t.submitBtn : t.submitBtn;
  document.getElementById('titleInput').placeholder = t.titlePlaceholder;
  document.getElementById('descInput').placeholder = t.descPlaceholder;

  // Category options
  document.getElementById('optCatPlaceholder').textContent = t.selectPlaceholder;
  document.getElementById('optDesign').textContent = t.catDesign;
  document.getElementById('optFunctionality').textContent = t.catFunctionality;
  document.getElementById('optPerformance').textContent = t.catPerformance;
  document.getElementById('optContent').textContent = t.catContent;
  document.getElementById('optMobile').textContent = t.catMobile;
  document.getElementById('optSecurity').textContent = t.catSecurity;
  document.getElementById('optOther').textContent = t.catOther;
  document.getElementById('optPhone').textContent = t.optPhone;

  // Site note
  if (autoDetectedSite) {
    document.getElementById('siteNote').textContent = t.autoDetected;
  }

  // Lang buttons
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.classList.toggle('active', btn.textContent.toLowerCase() === lang);
  });

  // Update site select placeholder
  updateSiteSelect();

  // If submit button is not in sending state, update text
  if (!document.getElementById('submitBtn').disabled) {
    document.getElementById('submitBtn').textContent = t.submitBtn;
  }
}

function updateSiteSelect() {
  const sel = document.getElementById('siteSelect');
  const t = T[currentLang];
  const currentVal = sel.value;
  sel.innerHTML = '';

  const placeholder = document.createElement('option');
  placeholder.value = '';
  placeholder.textContent = t.siteSelectPlaceholder;
  sel.appendChild(placeholder);

  sites.forEach(s => {
    const opt = document.createElement('option');
    opt.value = s;
    opt.textContent = s;
    sel.appendChild(opt);
  });

  if (currentVal && sites.includes(currentVal)) {
    sel.value = currentVal;
  }
}

function toggleContact() {
  const header = document.getElementById('contactToggle');
  const content = document.getElementById('contactContent');
  header.classList.toggle('open');
  content.classList.toggle('open');
}

function renderPreviews() {
  const grid = document.getElementById('previewGrid');
  grid.innerHTML = '';
  selectedFiles.forEach((file, i) => {
    const item = document.createElement('div');
    item.className = 'preview-item';
    const img = document.createElement('img');
    img.src = URL.createObjectURL(file);
    img.onload = () => URL.revokeObjectURL(img.src);
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.innerHTML = '&times;';
    btn.onclick = () => { selectedFiles.splice(i, 1); renderPreviews(); };
    item.appendChild(img);
    item.appendChild(btn);
    grid.appendChild(item);
  });
}

function addFiles(files) {
  const t = T[currentLang];
  const allowed = ['image/png', 'image/jpeg', 'image/webp', 'image/gif'];
  for (const f of files) {
    if (selectedFiles.length >= 5) {
      alert(t.maxImages);
      break;
    }
    if (allowed.includes(f.type) && f.size <= 5 * 1024 * 1024) {
      selectedFiles.push(f);
    }
  }
  renderPreviews();
}

async function loadSites() {
  try {
    const res = await fetch('/v1/sites', {
      headers: { 'X-API-Key': API_KEY }
    });
    if (res.ok) {
      const data = await res.json();
      sites = data.sites || [];
      updateSiteSelect();
      matchReferrer();
    }
  } catch (e) {
    console.error('Failed to load sites:', e);
  }
}

function matchReferrer() {
  const ref = document.referrer;
  if (!ref) return;
  try {
    const hostname = new URL(ref).hostname.toLowerCase();
    const match = sites.find(s => hostname === s || hostname.endsWith('.' + s));
    if (match) {
      const sel = document.getElementById('siteSelect');
      sel.value = match;
      sel.disabled = true;
      autoDetectedSite = true;
      document.getElementById('siteNote').textContent = T[currentLang].autoDetected;
      document.getElementById('siteNote').classList.add('auto-detected');

      // Pre-fill page URL with referrer
      const pageUrl = document.getElementById('pageUrlInput');
      if (!pageUrl.value) {
        pageUrl.value = ref;
      }
    }
  } catch (e) {}
}

async function submitForm(e) {
  e.preventDefault();
  const t = T[currentLang];
  const btn = document.getElementById('submitBtn');
  const msg = document.getElementById('resultMsg');
  msg.className = 'msg';
  msg.style.display = 'none';

  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span>' + t.sending;

  const form = new FormData();
  form.append('site_id', document.getElementById('siteSelect').value);
  form.append('title', document.getElementById('titleInput').value.trim());
  form.append('category', document.getElementById('categorySelect').value);
  form.append('description', document.getElementById('descInput').value.trim());

  const pageUrl = document.getElementById('pageUrlInput').value.trim();
  if (pageUrl) form.append('page_url', pageUrl);

  const firstName = document.getElementById('firstNameInput').value.trim();
  if (firstName) form.append('first_name', firstName);

  const lastName = document.getElementById('lastNameInput').value.trim();
  if (lastName) form.append('last_name', lastName);

  const contactType = document.getElementById('contactTypeSelect').value;
  if (contactType) form.append('contact_type', contactType);

  const contactValue = document.getElementById('contactValueInput').value.trim();
  if (contactValue) form.append('contact_value', contactValue);

  selectedFiles.forEach(f => form.append('images', f));

  try {
    const res = await fetch('/v1/reports', {
      method: 'POST',
      headers: { 'X-API-Key': API_KEY },
      body: form
    });
    const data = await res.json();
    if (res.ok) {
      msg.className = 'msg success';
      msg.textContent = t.successMsg;
      msg.style.display = 'block';
      document.getElementById('bugForm').reset();
      selectedFiles = [];
      renderPreviews();
      if (autoDetectedSite) {
        document.getElementById('siteSelect').disabled = true;
        matchReferrer();
      }
    } else {
      msg.className = 'msg error';
      msg.textContent = data.error || t.errorGeneric;
      msg.style.display = 'block';
    }
  } catch (err) {
    msg.className = 'msg error';
    msg.textContent = t.errorGeneric;
    msg.style.display = 'block';
  }

  btn.disabled = false;
  btn.textContent = t.submitBtn;
}

// Init
document.addEventListener('DOMContentLoaded', () => {
  setLang(detectLang());
  loadSites();

  document.getElementById('bugForm').addEventListener('submit', submitForm);

  // File input
  document.getElementById('fileInput').addEventListener('change', e => addFiles(e.target.files));

  // Drag and drop
  const dz = document.getElementById('dropZone');
  dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('drag-over'); });
  dz.addEventListener('dragleave', () => dz.classList.remove('drag-over'));
  dz.addEventListener('drop', e => {
    e.preventDefault();
    dz.classList.remove('drag-over');
    addFiles(e.dataTransfer.files);
  });
});
</script>
</body>
</html>
